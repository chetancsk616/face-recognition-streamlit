<!DOCTYPE html>
<html>
  <head>
    <title>Camera Stream</title>
  </head>
  <body>
    <video id="video" autoplay playsinline style="width: 90%; border-radius: 10px;"></video>
    <canvas id="canvas" style="display:none;"></canvas>
    <img id="output" style="width: 90%; margin-top: 10px; border-radius: 10px;" />

    <script>
      async function startCamera() {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ video: true });
          document.getElementById("video").srcObject = stream;
          console.log("Camera started!");
        } catch (error) {
          alert("Camera access denied or unavailable!");
        }
      }

      async function sendFrame() {
        const video = document.getElementById("video");
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        const frame = canvas.toDataURL("image/jpeg");

        try {
          const res = await fetch("https://chetancsk3000.streamlit.app/", {  // Replace with your Streamlit Cloud URL + '/detect'
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ image: frame }),
          });
          const data = await res.json();
          document.getElementById("output").src = data.image;
        } catch (e) {
          console.error("Detection error:", e);
        }
      }

      startCamera();
      setInterval(sendFrame, 1500);
    </script>
  </body>
</html>
